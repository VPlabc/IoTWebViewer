<!DOCTYPE html><html lang='en'><head><meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no'/>
    <title>The Hub by VPlab</title>
    <!-- Favicon -->
<link rel="apple-touch-icon" sizes="120x120" href="/static/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
<link rel="manifest" href="/static/favicon/site.webmanifest">
<link rel="mask-icon" href="/static/favicon/safari-pinned-tab.svg" color="#ffffff">
<link href="https://getbootstrap.com/docs/4.0/dist/css/bootstrap.min.css">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">

    <!--  CSS -->
    <link rel="stylesheet" href="{{url_for('static', filename='css/css.css')}}">
    <!-- Bootstrap CSS -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <!-- <link rel="stylesheet" href="{{url_for('static', filename='css/bootstrap.css')}}"> -->
    <!-- <link rel="stylesheet" href="bootstrap.css"> -->
    <!-- <link rel="stylesheet" href="main.css?v=7"> -->
    <style>
      body {
          background: #e8cbc0;
          background: -webkit-linear-gradient(to right, #e8cbc0, #636fa4);
          background: linear-gradient(to right, #e8cbc0, #636fa4);
          min-height: 100vh;
      }
    </style>
    </head>
    <body>
    <div id="top_bar" style='position:absolute;top:0px;height:5px;width:100%;background-color:#3c3c3c;'></div>
    <div class="container py-3">
    <header>
      <div class="d-flex flex-column flex-md-row align-items-center pb-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center text-dark text-decoration-none">
          <span class="fs-4 logo">
            <svg xmlns="http://www.w3.org/2000/svg" xml:space="preserve" width="14.424mm" height="16.7652mm" version="1.0" shape-rendering="geometricPrecision" text-rendering="geometricPrecision" image-rendering="optimizeQuality" fill-rule="evenodd" clip-rule="evenodd"
            viewBox="0 0 1442.46 1676.59"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            xmlns:xodm="http://www.corel.com/coreldraw/odm/2003">
            <g id="Layer_x0020_1">
            <metadata id="CorelCorpID_0Corel-Layer"/>
            <g id="_105553231336672">
            <path fill="#F8BD7A" d="M38.61 1180.88l96.03 -1 0.15 350.61 306.57 0.58 0.25 101.09 -402.83 0.98 -0.18 -452.27 0 0zm436.77 -1180.88l-474.5 0.22 -0.88 1675.74 474.8 0.63 0.58 -1676.57 0 -0.02z"/>
            <path fill="#F8BD7A" d="M828.7 85.3l-51.19 -0.52c-0.17,14.12 -0.11,28.14 -0.11,42.17 0,10.94 -1.81,26.06 0.67,35.93 3.68,14.72 26.64,9.01 40.49,12.45 6.78,1.69 12.17,1.58 18.8,3.12 4.18,0.96 3.2,1.01 8.9,2.69l5.7 1.6c0.58,0.19 1.21,0.4 1.8,0.57 0.56,0.17 1.18,0.41 1.73,0.58l51.18 16.42c25.25,10.03 53.02,24.89 73.54,41.64 4.11,3.36 7.22,5.14 12.58,9 27.26,19.63 49.15,43.01 69.68,69.68l20.21 29.98c0.85,1.45 1.41,2.37 2.71,4.66 1.92,3.38 2.85,5.15 4.22,7.9 11.45,22.89 18.97,40.29 26.45,65.08 13.15,43.54 22.11,64.25 22.07,116.54 -0.01,41.72 -8.54,78.65 -18.79,117.73 -12.01,45.75 -52.86,112.76 -85.66,144.93 -33.37,32.74 -39.34,35.67 -75.35,61.51l-63.1 30.48c-32.39,12.98 -80.98,22.64 -116.68,23.42l-1.11 89.27c19.96,0.32 29.32,-5.36 51.23,-3.64l45.43 72.02c11.76,19.41 30.57,5.83 59.85,-0.78l67.82 -25.98 60 -33.49c0.32,-18.72 -23.66,-90.37 -19.17,-100.86 2.7,-6.3 14.82,-10.96 19.73,-16.03 17.95,-18.52 38.06,-35.98 54.16,-56.31 16.43,-20.76 27.59,-22.48 53.64,-14.2 0.54,0.16 1.15,0.41 1.67,0.6l9.92 3.91c8.29,2.69 43.85,10.74 50.35,7.77 10.16,-4.63 15.48,-23.07 19.93,-33.28l48.95 -119.3c4.19,-10.69 5.62,-12.42 3.97,-27.71 -11.25,-5.72 -74.58,-41.75 -79.18,-48.03 -5.66,-18.28 0.23,-49.3 0.2,-69.64 -0.08,-52 -17.08,-63.08 13.32,-79.25l66.18 -41.58c0.46,-11.23 -1.37,-16.86 -3.91,-25.52 -8.56,-29.1 -21.95,-64.15 -34.57,-90.37l-27.4 -51.66c-3.56,-5.71 -3.12,-5.4 -7.48,-9.73 -18.53,-8.49 -73.83,20 -100.86,18.13l-41.19 -48.63c-15.24,-15.15 -32.25,-29.37 -47.68,-43.62 -7.09,-14.65 20.8,-77.37 18,-100.86l-29.24 -17.41c-25.54,-13.75 -56.77,-25.47 -83.19,-37.03 -16.84,-7.34 -38.46,-16.08 -56.95,-16.37 -18.38,-0.28 -25.84,26.79 -34.02,39.09 -3.02,4.51 -6.08,9.89 -9.23,14.77 -5.11,7.91 -13.15,20.5 -19.08,28.14l0.06 0.03z"/>
            <g>
                <path fill="#F8BD7A" d="M622.34 1557.02l0.13 0 0.08 0 204.01 -0.78 35.78 77.62 89.45 -0.1 -178.42 -364.79 -88.73 0.74 -180.27 364.26 80.2 -0.86 37.76 -76.07 0 -0.02zm-37.76 76.07l-80.2 0.87 80.2 -0.87 37.76 -76.07 -37.76 76.07zm139.06 -286.57l68.46 134.65 -133.02 -0.9 64.55 -133.75z"/>
            </g>
            <path fill="#F8BD7A" fill-rule="nonzero" d="M1053.4 1635.1l0 -366.04 239.39 0c39.91,0 69.94,7.57 90.47,22.97 20.39,15.38 30.53,38.14 30.53,68.13 0,14.6 -3.13,27.62 -9.5,39.16 -6.38,11.54 -15.39,20.83 -27.16,27.83 21.53,11.32 37.8,25.13 48.8,41.43 11.01,16.41 16.52,35.19 16.52,56.35 0,33.85 -12.27,60.67 -36.91,80.48 -24.53,19.82 -57.81,29.66 -99.85,29.66l-252.27 0 -0.02 0.01zm81.68 -82.66l149.12 0c16.2,0 28.89,-2.98 38.23,-9.01 9.24,-5.96 13.92,-14.13 13.92,-24.52 0,-10.22 -4.66,-18.4 -13.92,-24.42 -9.34,-6.03 -22.03,-9.06 -38.23,-9.06l-149.12 0 0 67.03 0 -0.02zm0 -140.94l150.35 0c16.42,0 29.05,-2.74 37.81,-8.11 8.74,-5.38 13.12,-13.14 13.12,-23.21 0,-10.69 -4.18,-18.66 -12.64,-23.98 -8.45,-5.31 -21.27,-7.97 -38.29,-7.97l-150.35 0 0 63.27z"/>
            </g>
            </g>
            </svg>
          </span>
        </a>
        <span class="fs-4 "  onclick="loadDevices();return false;">Device</span>
        <nav class="d-inline-flex mt-2 mt-md-0 ms-md-auto ">
        <span class="me-3 py-2 me-4 text-danger" id="rota_status"></span>
          <span class="me-3 py-2 text-dark text-decoration-none d-none"  style="cursor:pointer;" onclick="recheckSDCard();return false;" id="sdcard_status">
               <svg viewBox="0 0 24 24" style="width:16px;height:16px;color: #df1919;">
                  <path fill="currentColor" d="M8,2A2,2 0 0,0 6,4V11L4,13V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V4A2,2 0 0,0 18,2H8M9,4H11V8H9V4M12,4H14V8H12V4M15,4H17V8H15V4Z"></path>
              </svg>
          </span>
          <a class="me-3 py-2 text-dark text-decoration-none" href="/config">
               <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-gear" viewBox="0 0 16 16">
                <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z"/>
                <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z"/>
              </svg>
          </a>
        </nav>
      </div>
    </header>
    
    <main>
      <p>
        {% with messages = get_flashed_messages() %}
          {% if messages %}
         {% for message in messages %}
           <div class="alert alert-success">
            <strong>{{ message }}</strong>
          </div>
         {% endfor %}
          {% endif %}
        {% endwith %}
       </p>
       <div id="mqtt_alert" role="alert" class="alert alert-danger mb-4 d-none">The hub is not connected to the MQTT server</div>
       <div class="row row-cols-4 row-cols-md-6 row-cols-lg-8 row-cols-xl-5 text-center" id="lista"><div class="col-12 mt-5" style="width:100%!important;text-align:center;color:#cccccc;">loading ...</div></div>
       <div class="row text-center" id="listh"></div> 
    </main>
    </body>
    <script>
        dunit = 0;
const GROUP_SWITCH = 1
const GROUP_HT = 2
const GROUP_MOTION =  3
const GROUP_RELAY =  4
const GROUP_MOISTURE =  5
const GROUP_TEMP =  6
const GROUP_VALVE =  7
sensor_category = 0;

const CBLUE = "#33c5ff"
const CYELLOW = "#FFD333"
const CRED = "#FF6D33"

sensor_data_array = [];
sensor_info = [];
sensors_name = [];

var reloadPeriod = 5000;
var running = true;
    
function loadDevices() {
  
  getSystemStatus();
  if( document.getElementById("lista").innerHTML == "") return;
  const xhttp = new XMLHttpRequest();
  xhttp.addEventListener('progress', handleDeviceLoading);
  xhttp.open("GET", "/raw", true);
  xhttp.send();
        if(running) setTimeout(loadDevices, reloadPeriod);
  xhttp.onload = function() {
    if(this.responseText){
      clearPage();
      var sensors = this.responseText.split('\n');
      sensors.forEach( function(item) {
        AddDeviceBlock(item);
      });

    }else{
      document.getElementById("lista").innerHTML = "<div class='pt-3 text-center' style='width:100%!important'><p>No sensors have been detected.</p></div>";
    }
  }
}
// function run(){if(!running){running = true; loadDevices(); }}

function loadDevicesName(){

  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", "/names", true);
  xhttp.send();
  
  xhttp.onload = function() {
    if(this.responseText){
      sensors_name = [];
      var sensors = this.responseText.split('\n');
      sensors.forEach( function(item) {
        const [sid,sname] = item.split(','); 
        if( sid && sname && sname != "") sensors_name[sid] = sname.substring(0,15).toUpperCase();
      });
    }else{
      document.getElementById("lista").innerHTML = "<div class='pt-3 text-center' style='width:100%!important'><p>No sensors have been detected.</p></div>";
    }
  } 
}

function getDeviceReadableName(id){

  if( sensors_name[id] && sensors_name[id].length > 1 ) return sensors_name[id];
  else return id;
}

function deleteDevice(id){

  if (confirm("Delete?")) {
    const xhttp = new XMLHttpRequest();
   xhttp.open("GET", "/delete/"+id, true);
   xhttp.send();
  
   xhttp.onload = function() {
     if(this.responseText == "1") loadDevice(id);
     else alert('Error deleting file!');
    } 
  }
}

function recheckSDCard(id){

  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", "/retry_sd", true);
  xhttp.send();
  xhttp.onload = function() {
    if(this.responseText == "1"){
      getSystemStatus();
      loadDevices();
    }
  }
}


function reboot(){
  
  if (confirm("Reboot?")) {
    const xhttp = new XMLHttpRequest();
    xhttp.open("GET", "/reboot", true);
    xhttp.send();
    document.getElementsByTagName("main")[0].innerHTML = "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#aaa;'>restarting  ...</div>";
  }
  return false;
}

function enableReceiverOTA(){

  if (confirm("Enable Receiver OTA?")) {
    const xhttp = new XMLHttpRequest();
    xhttp.open("GET", "/rota_enable", true);
    xhttp.send();
  
    xhttp.onload = function() {
      getSystemStatus();
    }
  }
  return false;
}

function getSystemStatus(){
  
  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", "/status", true);
  xhttp.send();
    
  xhttp.onload = function() {
    if(this.responseText){
      const [status_sd_card,status_mqtt,status_ota] = this.responseText.split(','); 

     if(status_sd_card == 0) document.getElementById("sdcard_status").classList.remove("d-none");
     else document.getElementById("sdcard_status").classList.add("d-none");  

     if(status_mqtt == 0) document.getElementById("mqtt_alert").classList.remove("d-none");
     else document.getElementById("mqtt_alert").classList.add("d-none");  

     if(status_ota == 0)document.getElementById("top_bar").style.backgroundColor = "#ff0000";
     else if(status_ota == 2) document.getElementById("top_bar").style.backgroundColor = "#ffbf00"; 
     else document.getElementById("top_bar").style.backgroundColor = "#393939";
     
    }

  }
}

function clearList(){
  
  document.getElementById("lista").innerHTML = "";
}

function clearPage(){
  
  document.getElementById("lista").innerHTML = "";
  document.getElementById("listh").innerHTML = "";
}

function AddDeviceBlock(item){

     const [sid,scategory,sstatus,stemperature,shumidity,sunit,sbattery,mbattery,stimetamp,rssi] = item.split(',');  
     if(!sid) return;
     
     var perc = (sbattery - 3.3) / 0.006 | 0; 
          
     s = "";
     if(scategory==0) s = "view history"; 
     if(scategory==1 && sstatus == 1)   s = "OPEN"; 
     if(scategory==1 && sstatus == 0)   s = "CLOSED"; 
     if(scategory==3 && sstatus == 1)   s = "MOTION"; 
     if(scategory==3 && sstatus == 0)   s = "CLEAR"; 
     if(scategory==4 && sstatus == 1)   s = "ON"; 
     if(scategory==4 && sstatus == 0)   s = "OFF"; 
     if(scategory==7 && sstatus == 1)   s = "OPEN"; 
     if(scategory==7 && sstatus == 0)   s = "CLOSED"; 
     if(scategory==2)  s = parseFloat(stemperature).toFixed(1) + sunit; h = parseFloat(shumidity).toFixed(1) + "%";
     if(scategory==5)  h = parseFloat(shumidity).toFixed(1) + "%";
     if(scategory==6)  s = parseFloat(stemperature).toFixed(1) + sunit;;
     
     if( sunit == "Â°F") dunit = 1;

     if(sbattery >= 3.75)  b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-full' viewBox='0 0 16 16'><path d='M2 6h10v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";  
     else if(sbattery >= 3.4) b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-half' viewBox='0 0 16 16'><path d='M2 6h5v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";
     else b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery text-danger' viewBox='0 0 16 16'><path d='M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";

     if(sbattery < 3.4) bgc = "text-danger";
     else bgc = "";
     
     if(mbattery >= 13.5)  b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-full' viewBox='0 0 16 16'><path d='M2 6h10v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";  
     else if(mbattery >= 12.5) b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-half' viewBox='0 0 16 16'><path d='M2 6h5v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";
     else b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery text-danger' viewBox='0 0 16 16'><path d='M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";

     if(mbattery < 11.5) bgc = "text-danger";
     else bgc = "";

     if(scategory==1)       icon = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-door-closed' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z'/><path d='M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z'/></svg>";  
     else if(scategory==2){  icon = "<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='currentColor' class='bi bi-thermometer-half' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z'/><path d='M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z'/></svg>";
                             icon1 = "<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='currentColor' class='bi bi-droplet' viewBox='0 0 16 16'><path fill-rule='evenodd' d='M7.21.8C7.69.295 8 0 8 0c.109.363.234.708.371 1.038.812 1.946 2.073 3.35 3.197 4.6C12.878 7.096 14 8.345 14 10a6 6 0 0 1-12 0C2 6.668 5.58 2.517 7.21.8zm.413 1.021A31.25 31.25 0 0 0 5.794 3.99c-.726.95-1.436 2.008-1.96 3.07C3.304 8.133 3 9.138 3 10a5 5 0 0 0 10 0c0-1.201-.796-2.157-2.181-3.7l-.03-.032C9.75 5.11 8.5 3.72 7.623 1.82z'/><path fill-rule='evenodd' d='M4.553 7.776c.82-1.641 1.717-2.753 2.093-3.13l.708.708c-.29.29-1.128 1.311-1.907 2.87l-.894-.448z'/></svg>";  
     }
     else if(scategory==3)  icon = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-walk' style='margin-top:-8px' viewBox='0 0 320 512 '><path d='M208 96c26.5 0 48-21.5 48-48S234.5 0 208 0s-48 21.5-48 48 21.5 48 48 48zm94.5 149.1l-23.3-11.8-9.7-29.4c-14.7-44.6-55.7-75.8-102.2-75.9-36-.1-55.9 10.1-93.3 25.2-21.6 8.7-39.3 25.2-49.7 46.2L17.6 213c-7.8 15.8-1.5 35 14.2 42.9 15.6 7.9 34.6 1.5 42.5-14.3L81 228c3.5-7 9.3-12.5 16.5-15.4l26.8-10.8-15.2 60.7c-5.2 20.8.4 42.9 14.9 58.8l59.9 65.4c7.2 7.9 12.3 17.4 14.9 27.7l18.3 73.3c4.3 17.1 21.7 27.6 38.8 23.3 17.1-4.3 27.6-21.7 23.3-38.8l-22.2-89c-2.6-10.3-7.7-19.9-14.9-27.7l-45.5-49.7 17.2-68.7 5.5 16.5c5.3 16.1 16.7 29.4 31.7 37l23.3 11.8c15.6 7.9 34.6 1.5 42.5-14.3 7.7-15.7 1.4-35.1-14.3-43zM73.6 385.8c-3.2 8.1-8 15.4-14.2 21.5l-50 50.1c-12.5 12.5-12.5 32.8 0 45.3s32.7 12.5 45.2 0l59.4-59.4c6.1-6.1 10.9-13.4 14.2-21.5l13.5-33.8c-55.3-60.3-38.7-41.8-47.4-53.7l-20.7 51.5z'></path></svg>";
     else if(scategory==4)  icon = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-lightbulb' viewBox='0 0 16 16'><path d='M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z'/></svg>";
     else if(scategory==5)  icon = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-moisture' viewBox='0 0 16 16'><path d='M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5h-2zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a28.458 28.458 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a28.458 28.458 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001L7 1.5zm0 0-.364-.343L7 1.5zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267z'/></svg>";
     else if(scategory==6)  icon = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-thermometer-half' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z'/><path d='M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z'/></svg>";
     else icon = "";
     iconSetting = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-gear' viewBox='0 0 16 16'><path d='M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z'/><path d='M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z'/></svg>";
     iconHistory = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-clock-history' viewBox='0 0 16 16'><path d='M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z'/><path d='M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z'/><path d='M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z'/></svg>";
     iconRSSI = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-broadcast' viewBox='0 0 16 16'><path d='M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0z'/></svg>";
     if(scategory == 0) c = 'color:#dfdfdf;';
     else c = '';

     html = "<div class='col-sm-12 col-md-6 col-lg-3 col-xl-3  mb-3' style='border-top-right-radius:1rem;border-top-left-radius:1rem;border-bottom-left-radius:1rem;border-bottom-right-radius:1rem;'>";
     html += " <div class='pointer card  shadow  bg-white rounded' >";
     if(scategory != 0 && scategory == 7 && mbattery > 10) html += "<div class='card-header py-3 sensor_header'><div class='row'><div class='col'><p class='my-0 fw-normal '> "+getDeviceReadableName(sid)+"</p></div><div class='col'><small>"+sbattery+"v  "+b+ " | " +mbattery+"v  "+b1+"</small></div></div></div>";
     else html += "<div class='card-header py-3 sensor_header align-items-start'><div class='row'><div class='col'><p class='my-0 fw-normal'> "+getDeviceReadableName(sid)+"</p></div><div class='col'>"+sbattery+"v  "+b+"</div></div></div>";
     html += "     <div class='card-body'><div class='row'>";
      if(scategory != 0 && scategory == 4  && sstatus == 0)html += "<div class='col-4'><h2 class='card-title pricing-card-title mt-1' style='"+c+"'><button type='button' class='btn btn-warning align-self-center' onclick=\"changeState('"+sid+"/1')\">ON</button></h2></div><div class='col-8'><h2 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'> "+icon+" "+s+"</h2></div>";
      if(scategory != 0 && scategory == 4  && sstatus == 1)html += "<div class='col-4'><h2 class='card-title pricing-card-title mt-1' style='"+c+"'><button type='button' class='btn btn-warning align-self-center' onclick=\"changeState('"+sid+"/0')\">OFF</button></h2></div><div class='col-8'><h3 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'> "+icon+" "+s+"</h3></div>";
      if(scategory != 0 && scategory == 7  && sstatus == 1)html += "<div class='col-4'><h2 class='card-title pricing-card-title mt-1' style='"+c+"'><button type='button' class='btn btn-warning align-self-center' onclick=\"changeState('"+sid+"/0')\">Close</button></h2></div><div class='col-8'><h3 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'> "+icon+" "+s+"</h3></div>";
      if(scategory != 0 && scategory == 7  && sstatus == 0)html += "<div class='col-4'><h2 class='card-title pricing-card-title mt-1' style='"+c+"'><button type='button' class='btn btn-warning align-self-center' onclick=\"changeState('"+sid+"/1')\">Open</button></h2></div><div class='col-8'><h3 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'> "+icon+" "+s+"</h3></div>";
      if(scategory != 0 && scategory != 2 && scategory != 4 && scategory != 5 && scategory != 7 )html += "<div class='col-10'><h2 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'>"+icon+" "+s+"</h2></div><div class='col-2'><h3 class='card-title pricing-card-title mt-1' style='"+c+"'></h3></div>";
      if(scategory != 0 && scategory == 5 )html += "<div class='col-10'><h2 class='card-title pricing-card-title mt-1 align-self-center' style='"+c+"'>"+icon+" "+h+"</h2></div><div class='col-2'><h3 class='card-title pricing-card-title mt-1' style='"+c+"'></h3></div>";
      if(scategory != 0 && scategory == 2 )html += "<div class='col-6'><h4 class='card-title pricing-card-title mt-1' style='"+c+"'>"+icon+" "+s+"</h3></div><div class='col-6'> \
                                                    <h4 class='card-title pricing-card-title mt-1' style='"+c+"'>"+icon1+" "+h+"</h4></div>";
    //  if(scategory != 0 && scategory != 4 ) html += "       <ul class='list-unstyled mt-1 mb-1'><li>"+sbattery+"v  "+b+"</li><li><small>"+getFormatedDuration(stimetamp)+"</small></li></ul>";
    //  else if(scategory == 4) html += "       <ul class='list-unstyled mt-1 mb-1'><li>"+"main: "+sbattery+"v  "+b+ " | " +sbattery+"v  "+b+"</li><li><small>"+getFormatedDuration(stimetamp)+"</small></li></ul>";
     html += "       </div><ul class='list-unstyled '><li>" + iconRSSI + " " + rssi + "</li><li><small style='"+c+"'>"+getFormatedDuration(stimetamp)+"</small></li></ul>";

     html += "</div>"
     html += "<div class='card-footer sensor_header'>";
     html += "<div class='row '>";
      // if(scategory==4 && sstatus == 1) html += "<div class='col'><button type='button' class='btn btn-warning' onclick=\"changeState('"+sid+"/0')\">OFF</button></div>";
      // if(scategory==4 && sstatus == 0) html += "<div class='col'><button type='button' class='btn btn-warning' onclick=\"changeState('"+sid+"/1')\">ON</button></div>";
    
     html += "<div class='col-6 '><button type='button' class='btn btn-secondary btn-sm' onclick=\"loadDevice('"+sid+"')\"><h6><small>" + iconHistory + " View</small></h6></button></div>";
     html += "<div class='col-6 '><button type='button' class='btn btn-secondary btn-sm' ><h6><small>" + iconSetting + " Setting</small></h6></button></div>";
     
     html += "   </div></div></div>";
     document.getElementById("lista").innerHTML += html; 
}

function changeState(id) {
  const xhttp = new XMLHttpRequest();
  xhttp.open("GET", "/changestate/"+ id , true);
  xhttp.send();
  xhttp.onload = function() {
  
  }
}
function loadDevice(id) {
  
  sensor_data_array = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
  sensor_data_array["min"] = 1000;
  sensor_data_array["max"] = 0;
  sensor_info = [];
  sensor_info['filename'] = id;
  
  cursorLoading();
  const xhttp = new XMLHttpRequest();
  xhttp.addEventListener('progress', handleDeviceLoading);
  xhttp.open("GET", "/sensor/"+ id, true);
  xhttp.send();
  
  xhttp.onload = function() {
    cursorDone();
    document.getElementById("lista").innerHTML = "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#cccccc;'>loading ... 100%</div>";  
    if(this.responseText && this.responseText != "No SD card found."){
      clearPage();
      html = " <div class='col-12'>";
      html += "     <div class='row alert mb-4' style='padding:25px!important;background-color:#393939;margin-top:-27px;color:white;border-top-right-radius:0rem;border-top-left-radius:0rem;border-bottom-left-radius:0.5rem;border-bottom-right-radius:0.6rem;'><div id='icon' class='col-1'></div><div class='my-0 fw-normal col-2' style='text-align:left'> <a style='color:white' type='button' class='btn btn-warning' href='/sen'>back</a>"+getDeviceReadableName(id.substring(0, id.length-4))+"</div><div id='scount' class='col-4'>"+id+"</div><div class='col-3'><a  type='button' class='btn btn-warning' style='color:red' href='#' onclick=\"deleteDevice('"+id+"');return false;\"> Delete</a></div><div id='sbattery' class='col-2'></div></div><div id='sgraph'></div><div id='sdata' class='p-2' style='color:#666666'></div>";

      document.getElementById("listh").innerHTML += html; 
      var sensors = this.responseText.split('\n');
      sensors.forEach( function(item) {
        AddDeviceLine(item);
        collectDeviceData(item);
      });
       html = " </div>";
      document.getElementById("listh").innerHTML += html; 
      if( sensor_info['count'] > 1){
        showLatestData();
        plotDeviceData();
      }else{
        document.getElementById("listh").innerHTML += "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#cccccc;'>No data</div>";
      }
    }else{
      document.getElementById("listh").innerHTML += "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#cccccc;'>No file found</div>";
    }
  }
}

function handleDeviceLoading(e){

  if (e.lengthComputable)
    document.getElementById("lista").innerHTML = "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#cccccc;'>loading ... "+ parseInt((e.loaded / e.total) * 100) +"%</div>";  
}

function AddDeviceLine(item){

    const [ltimestamp,lcategory,lstatus,ltemperature,lhumidity,lbattery,lmbattery,lrssi] = item.split(',');  
    if(!ltimestamp || !lcategory || !lbattery) return;

    sensor_category = lcategory;
    sensor_info['category'] = lcategory;
    if( sensor_info['count'] > 0 ) sensor_info['count'] = sensor_info['count'] + 1;
    else sensor_info['count'] = 1;
    sensor_info['battery'] = lbattery;
    sensor_info['mbattery'] = lmbattery;
    sensor_info['timestamp'] = ltimestamp;
    
    const date = new Date(ltimestamp * 1000);

     if(lcategory==1)       document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-door-closed' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z'/><path d='M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z'/></svg>";  
     else if(lcategory==2)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-thermometer-half' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z'/><path d='M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z'/></svg>";
     else if(lcategory==3)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-walk' style='margin-top:-8px' viewBox='0 0 320 512 '><path d='M208 96c26.5 0 48-21.5 48-48S234.5 0 208 0s-48 21.5-48 48 21.5 48 48 48zm94.5 149.1l-23.3-11.8-9.7-29.4c-14.7-44.6-55.7-75.8-102.2-75.9-36-.1-55.9 10.1-93.3 25.2-21.6 8.7-39.3 25.2-49.7 46.2L17.6 213c-7.8 15.8-1.5 35 14.2 42.9 15.6 7.9 34.6 1.5 42.5-14.3L81 228c3.5-7 9.3-12.5 16.5-15.4l26.8-10.8-15.2 60.7c-5.2 20.8.4 42.9 14.9 58.8l59.9 65.4c7.2 7.9 12.3 17.4 14.9 27.7l18.3 73.3c4.3 17.1 21.7 27.6 38.8 23.3 17.1-4.3 27.6-21.7 23.3-38.8l-22.2-89c-2.6-10.3-7.7-19.9-14.9-27.7l-45.5-49.7 17.2-68.7 5.5 16.5c5.3 16.1 16.7 29.4 31.7 37l23.3 11.8c15.6 7.9 34.6 1.5 42.5-14.3 7.7-15.7 1.4-35.1-14.3-43zM73.6 385.8c-3.2 8.1-8 15.4-14.2 21.5l-50 50.1c-12.5 12.5-12.5 32.8 0 45.3s32.7 12.5 45.2 0l59.4-59.4c6.1-6.1 10.9-13.4 14.2-21.5l13.5-33.8c-55.3-60.3-38.7-41.8-47.4-53.7l-20.7 51.5z'></path></svg>";
     else if(lcategory==4)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-lightbulb' viewBox='0 0 16 16'><path d='M2 6a6 6 0 1 1 10.174 4.31c-.203.196-.359.4-.453.619l-.762 1.769A.5.5 0 0 1 10.5 13a.5.5 0 0 1 0 1 .5.5 0 0 1 0 1l-.224.447a1 1 0 0 1-.894.553H6.618a1 1 0 0 1-.894-.553L5.5 15a.5.5 0 0 1 0-1 .5.5 0 0 1 0-1 .5.5 0 0 1-.46-.302l-.761-1.77a1.964 1.964 0 0 0-.453-.618A5.984 5.984 0 0 1 2 6zm6-5a5 5 0 0 0-3.479 8.592c.263.254.514.564.676.941L5.83 12h4.342l.632-1.467c.162-.377.413-.687.676-.941A5 5 0 0 0 8 1z'/></svg>";
     else if(lcategory==5)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-moisture' viewBox='0 0 16 16'><path d='M13.5 0a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V7.5h-1.5a.5.5 0 0 0 0 1H15v2.75h-.5a.5.5 0 0 0 0 1h.5V15h-1.5a.5.5 0 0 0 0 1h2a.5.5 0 0 0 .5-.5V.5a.5.5 0 0 0-.5-.5h-2zM7 1.5l.364-.343a.5.5 0 0 0-.728 0l-.002.002-.006.007-.022.023-.08.088a28.458 28.458 0 0 0-1.274 1.517c-.769.983-1.714 2.325-2.385 3.727C2.368 7.564 2 8.682 2 9.733 2 12.614 4.212 15 7 15s5-2.386 5-5.267c0-1.05-.368-2.169-.867-3.212-.671-1.402-1.616-2.744-2.385-3.727a28.458 28.458 0 0 0-1.354-1.605l-.022-.023-.006-.007-.002-.001L7 1.5zm0 0-.364-.343L7 1.5zm-.016.766L7 2.247l.016.019c.24.274.572.667.944 1.144.611.781 1.32 1.776 1.901 2.827H4.14c.58-1.051 1.29-2.046 1.9-2.827.373-.477.706-.87.945-1.144zM3 9.733c0-.755.244-1.612.638-2.496h6.724c.395.884.638 1.741.638 2.496C11 12.117 9.182 14 7 14s-4-1.883-4-4.267z'/></svg>";
     else if(lcategory==6)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='32' height='32' fill='currentColor' class='bi bi-thermometer-half' style='margin-top:-8px' viewBox='0 0 16 16'><path d='M9.5 12.5a1.5 1.5 0 1 1-2-1.415V6.5a.5.5 0 0 1 1 0v4.585a1.5 1.5 0 0 1 1 1.415z'/><path d='M5.5 2.5a2.5 2.5 0 0 1 5 0v7.55a3.5 3.5 0 1 1-5 0V2.5zM8 1a1.5 1.5 0 0 0-1.5 1.5v7.987l-.167.15a2.5 2.5 0 1 0 3.333 0l-.166-.15V2.5A1.5 1.5 0 0 0 8 1z'/></svg>";
     else if(lcategory==7)  document.getElementById("icon").innerHTML = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-broadcast' viewBox='0 0 16 16'><path d='M3.05 3.05a7 7 0 0 0 0 9.9.5.5 0 0 1-.707.707 8 8 0 0 1 0-11.314.5.5 0 0 1 .707.707zm2.122 2.122a4 4 0 0 0 0 5.656.5.5 0 1 1-.708.708 5 5 0 0 1 0-7.072.5.5 0 0 1 .708.708zm5.656-.708a.5.5 0 0 1 .708 0 5 5 0 0 1 0 7.072.5.5 0 1 1-.708-.708 4 4 0 0 0 0-5.656.5.5 0 0 1 0-.708zm2.122-2.12a.5.5 0 0 1 .707 0 8 8 0 0 1 0 11.313.5.5 0 0 1-.707-.707 7 7 0 0 0 0-9.9.5.5 0 0 1 0-.707zM10 8a2 2 0 1 1-4 0 2 2 0 0 1 4 0z'/></svg>";
     else document.getElementById("icon").innerHTML = "";
     
     html  = "<div class='row mb-0' style='font-size:0.8rem;'><div class='col-4 text-left'>"+date.toDateString()+"</div><div class='col-2 text-left'>"+date.toLocaleTimeString('en-US')+"</div>";
     if( lcategory == 1){
        if(lstatus == 0) html += "<div class='col-2 text-left'>CLOSED</div>"; 
        else html += "<div class='col-2 text-left'>OPEN</div>";       
     }
     if( lcategory == 2){
        if(lhumidity > 0){
            html += "<div class='col-2 text-left'>"+getFormatedTemperature(ltemperature,dunit) + "</div>"; 
            html += "<div class='col-2 text-left'>"+lhumidity+"%</div>";   
        }else{
            html += "<div class='col-4 text-left'>"+getFormatedTemperature(ltemperature,dunit) + "</div>"; 
        }
     } 
     if( lcategory == 3){
        if(lstatus == 1) html += "<div class='col-2 text-left'>MOTION</div>"; 
        else html += "<div class='col-2 text-left'>CLEAR</div>";     
     } 
     if( lcategory == 4){
        if(lstatus == 1) html += "<div class='col-2 text-left'>ON</div>"; 
        else html += "<div class='col-2 text-left'>OFF</div>";  
     } 
     if( lcategory == 5){
        html += "<div class='col-2 text-left'>"+lhumidity+"%</div>";  
     } 
     if( lcategory == 6){
        html += "<div class='col-2 text-left'>"+ltemperature+"%</div>";  
     } 
     if( lcategory == 7){
        if(lstatus == 1) html += "<div class='col-2 text-left'>OPEN</div>"; 
        else html += "<div class='col-2 text-left'>CLOSE</div>";  
     } 


     if(lbattery >= 3.75)  b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-full' viewBox='0 0 16 16'><path d='M2 6h10v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";  
     else if(lbattery >= 3.4) b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-half' viewBox='0 0 16 16'><path d='M2 6h5v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";
     else b = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery text-danger' viewBox='0 0 16 16'><path d='M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";

     
     if(lmbattery >= 13.2)  b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-full' viewBox='0 0 16 16'><path d='M2 6h10v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";  
     else if(lmbattery >= 12.5) b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery-half' viewBox='0 0 16 16'><path d='M2 6h5v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";
     else b1 = "<svg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-battery text-danger' viewBox='0 0 16 16'><path d='M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";


     html += "<div class='col-1 text-left'>"+ iconRSSI + " " + lrssi+"</div>"; 
     html += "<div class='col-1 text-center'>"+ b + " " + lmbattery+"v</div>"; 
     if(lbattery >= 10)html += "<div class='col-1 text-center'>"+ b1 + " " + lbattery+"v</div>"; 
     html += "</div>"
     var sdata = document.getElementById("sdata");
     sdata.innerHTML = html + sdata.innerHTML; 
     if(sensor_info['count'] > 200)  sdata.removeChild(sdata.lastChild);
}


function showLatestData(){

     if(sensor_info['mbattery']  >= 3.75)  b = "<svg xmlns='http://www.w3.org/2000/svg' width='36' height='20' fill='currentColor' class='bi bi-battery-full' viewBox='0 0 16 16'><path d='M2 6h10v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";  
     else if(sensor_info['mbattery']  >= 3.4) b = "<svg xmlns='http://www.w3.org/2000/svg' width='36' height='20' fill='currentColor' class='bi bi-battery-half' viewBox='0 0 16 16'><path d='M2 6h5v4H2V6z'/><path d='M2 4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H2zm10 1a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h10zm4 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";
     else b = "<svg xmlns='http://www.w3.org/2000/svg' width='36' height='20' fill='currentColor' class='bi bi-battery text-danger' viewBox='0 0 16 16'><path d='M0 6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6zm2-1a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2zm14 3a1.5 1.5 0 0 1-1.5 1.5v-3A1.5 1.5 0 0 1 16 8z'/></svg>";

    document.getElementById("scount").innerHTML =  sensor_info['count'] + " records  ";
    document.getElementById("sbattery").innerHTML = b + sensor_info['mbattery'] + "V";   
}


function plotDeviceData(){
  
    if(sensor_category == GROUP_SWITCH) plotDeviceDataMotion();
    else if(sensor_category == GROUP_HT) plotDeviceDataHT(); 
    else if(sensor_category == GROUP_MOTION) plotDeviceDataMotion();  
    else if(sensor_category == GROUP_RELAY) plotDeviceDataRelay();   
    else if(sensor_category == GROUP_MOISTURE) plotDeviceDataMoisture();  
    else if(sensor_category == GROUP_TEMP) plotDeviceDataTemp(); 
    else if(sensor_category == GROUP_VALVE) plotDeviceDataValve(); 
}

function plotDeviceDataSwitch(){}
function plotDeviceDataValve(){}

function plotDeviceDataHT(){

  html = "<div class='row m-5 mb-0' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){
    if(sensor_data_array[i] != 0) t = sensor_data_array[i];
    else t = "-";
    html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+t+"</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  }  
  html += "</div></div>"; 
  height = sensor_data_array["max"]-sensor_data_array["min"];
  if( height < 20) height = 20;
  html += "<div class='m-5 mb-0 mt-4'><svg id='svg' class='chart' viewBox='0 0 230 "+height+"'><polyline id='poly' fill='none' stroke='#d03535' stroke-width='0.5' points=''></polyline></svg></div>";
  html += "<div class='row m-5 mt-0' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){
    html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+(i)+":00</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  } 
  html += "</div></div>"; 
  document.getElementById("sgraph").innerHTML = html;
  var svg = document.getElementById('svg');
  var polyline= document.getElementById('poly');
  for(var i=0; i<23;i++){
     if( sensor_data_array[i] > 0 ){
        point = svg.createSVGPoint();
        if(i==23) point.x = i*10 - 5;
        else point.x = parseInt(5+i*9.86);
        point.y = sensor_data_array["max"] - sensor_data_array[i];
        polyline.points.appendItem(point);
     }
     
     if( true == false ){
        if(i==23) point.x = i*10 - 5;
        else point.x = parseInt(5+i*9.86);

        if( sensor_data_array["max"]-sensor_data_array["min"] <= 5 ) point.y =  sensor_data_array["max"] - sensor_data_array[i] ;
        else point.y = 20 / (sensor_data_array["max"]-sensor_data_array["min"] ) * ( sensor_data_array["max"] - sensor_data_array[i] );        
      }

  }

}

function plotDeviceDataMoisture(){

html = "<div class='row m-5 mb-0' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
for(var i=0; i<24;i++){
  if(sensor_data_array[i] != 0) t = sensor_data_array[i];
  else t = "-";
  html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+t+"</div>";  
  if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
}  
html += "</div></div>"; 
height = sensor_data_array["max"]-sensor_data_array["min"];
if( height < 20) height = 20;
html += "<div class='m-5 mb-0 mt-4'><svg id='svg' class='chart' viewBox='0 0 230 "+height+"'><polyline id='poly' fill='none' stroke='#d03535' stroke-width='0.5' points=''></polyline></svg></div>";
html += "<div class='row m-5 mt-0' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
for(var i=0; i<24;i++){
  html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+(i)+":00</div>";  
  if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
} 
html += "</div></div>"; 
document.getElementById("sgraph").innerHTML = html;
var svg = document.getElementById('svg');
var polyline= document.getElementById('poly');
  for(var i=0; i<23;i++){
    if( sensor_data_array[i] > 0 ){
        point = svg.createSVGPoint();
        if(i==23) point.x = i*10 - 5;
        else point.x = parseInt(5+i*9.86);
        point.y = sensor_data_array["max"] - sensor_data_array[i];
        polyline.points.appendItem(point);
    }
    
    if( true == false ){
        if(i==23) point.x = i*10 - 5;
        else point.x = parseInt(5+i*9.86);

        if( sensor_data_array["max"]-sensor_data_array["min"] <= 5 ) point.y =  sensor_data_array["max"] - sensor_data_array[i] ;
        else point.y = 20 / (sensor_data_array["max"]-sensor_data_array["min"] ) * ( sensor_data_array["max"] - sensor_data_array[i] );        
      }
  }

}

function plotDeviceDataMotion(){
  
  html = "<div class='row mt-5' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){
    mid_point = (sensor_data_array["max"] - sensor_data_array["min"]) / 2 + sensor_data_array["min"];
    if( sensor_data_array[i] >= mid_point ) c = "background-color:" + CRED;
    else if( sensor_data_array[i] >= sensor_data_array["min"] ) c = "background-color:" + CYELLOW;
    else c = "";
    if(i==0) l = "border-left:solid 1px #3d568a;";
    else l = "";
    if(i==23) r = "border-right:solid 1px #3d568a;";
    else r = "";
    html += "<div class='col-1' style='padding-left:0!important;padding-right: 0!important;border-top:solid 1px #3d568a;border-bottom:solid 1px #3d568a;border-right:solid 1px #b2b7c1;"+l+r+c+"'>&nbsp;</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  }  
  html += "</div></div>";

  html += "<div class='row mb-5' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){

    html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+(i)+":00</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  }  
  html += "</div></div>";  
  document.getElementById("sgraph").innerHTML = html;
}


function plotDeviceDataRelay(){
  
  html = "<div class='row mt-5' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){
    mid_point = (sensor_data_array["max"] - sensor_data_array["min"]) / 2 + sensor_data_array["min"];
    if( sensor_data_array[i] >= mid_point ) c = "background-color:" + CRED;
    else if( sensor_data_array[i] >= sensor_data_array["min"] ) c = "background-color:" + CYELLOW;
    else c = "";
    if(i==0) l = "border-left:solid 1px #3d568a;";
    else l = "";
    if(i==23) r = "border-right:solid 1px #3d568a;";
    else r = "";
    html += "<div class='col-1' style='padding-left:0!important;padding-right: 0!important;border-top:solid 1px #3d568a;border-bottom:solid 1px #3d568a;border-right:solid 1px #b2b7c1;"+l+r+c+"'>&nbsp;</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  }  
  html += "</div></div>";

  html += "<div class='row mb-5' style='margin-left: 0px;margin-right: 0px;'><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;margin-left: 0px;padding-right: 0px;margin-right: 0px;'>";
  for(var i=0; i<24;i++){

    html += "<div class='col-1' style='font-size:8px;padding-left:0!important;padding-right:0!important;'>"+(i)+":00</div>";  
    if(i==11)  html += "</div><div class='col-6 row' style='border-left-width: 0px;border-left-style: solid;padding-left: 0px;margin-left: 0px;margin-right: 0px;'>";
  }  
  html += "</div></div>";  
  document.getElementById("sgraph").innerHTML = html;
}

function collectDeviceData(item){

    if(sensor_category == GROUP_SWITCH) collectDeviceDataMotion(item);
    else if(sensor_category == GROUP_HT) collectDeviceDataHT(item); 
    else if(sensor_category == GROUP_MOTION) collectDeviceDataMotion(item); 
    else if(sensor_category == GROUP_RELAY) collectDeviceDataRelay(item); 
    else if(sensor_category == GROUP_MOISTURE) collectDeviceDataMoisture(item);  
    else if(sensor_category == GROUP_TEMP) collectDeviceDataTemp(item);
    else if(sensor_category == GROUP_VALVE) collectDeviceDataValve(item);
}

function collectDeviceDataSwitch(item){}
function collectDeviceDataValve(item){}
function collectDeviceDataRelay(item){}
function collectDeviceDataMoisture(item){}

function collectDeviceDataHT(item){
  
     const [ltimestamp,lcategory,lstatus,ltemperature,lhumidity,lbattery] = item.split(',');  
     if(!ltimestamp) return;

     var d = new Date(ltimestamp*1000);
     var current_date = new Date();
     var current_day = current_date.getDate();
     if(d.getDate() == current_day){
        tlocal = getFormatedTemperatureNoUnit(ltemperature,dunit);
        hlocal = getFormatedTemperatureNoUnit(lhumidity,"%");
        sensor_data_array[d.getHours()] = tlocal;
        if( tlocal > sensor_data_array["max"]) sensor_data_array["max"] = tlocal;
        if( tlocal < sensor_data_array["min"]) sensor_data_array["min"] = tlocal;
     }  
}

function collectDeviceDataTemp(item){
  
  const [ltimestamp,lcategory,lstatus,ltemperature,lhumidity,lbattery] = item.split(',');  
  if(!ltimestamp) return;

  var d = new Date(ltimestamp*1000);
  var current_date = new Date();
  var current_day = current_date.getDate();
  if(d.getDate() == current_day){
     tlocal = getFormatedTemperatureNoUnit(ltemperature,dunit);
     sensor_data_array[d.getHours()] = tlocal;
     if( tlocal > sensor_data_array["max"]) sensor_data_array["max"] = tlocal;
     if( tlocal < sensor_data_array["min"]) sensor_data_array["min"] = tlocal;
  }  
}

function collectDeviceDataMotion(item){

     const [ltimestamp,lcategory,lstatus,ltemperature,lhumidity,lbattery] = item.split(',');  
     if(!ltimestamp) return;

     var d = new Date(ltimestamp*1000);
     var current_date = new Date();
     var current_day = current_date.getDate();
     if(d.getDate() == current_day){
        sensor_data_array[d.getHours()] += 1;   
        if( sensor_data_array[d.getHours()] > sensor_data_array["max"]) sensor_data_array["max"] = sensor_data_array[d.getHours()];
        if( sensor_data_array[d.getHours()] < sensor_data_array["min"]) sensor_data_array["min"] = sensor_data_array[d.getHours()];
     }
}

        
function getFormatedDuration(stimestamp){

  duration = Math.floor(Date.now() / 1000) - stimestamp;
  if (duration >= 86400){
    d = parseInt(duration/86400);
    if( d == 1 ) return d + " day ago";
    else return d + " days ago";
  }
  if (duration >= 3600){
    h = parseInt(duration/3600);
    if( h == 1 ) return h + " hour ago";
    else return h + " hours ago";
  }
  if (duration >= 60) {
    m = parseInt(duration/60);
    if( m == 1 ) return m + " minute ago";
    else return m + " minutes ago";    
  }
  if( duration < 60) return duration + " second ago";  
  else return duration + " seconds ago"; 
}


function getFormatedTemperature(t,u){
     
  if (u == 0 ) return (parseFloat(t).toFixed(1)) + "Â°C";
  else return (parseFloat(t*1.8+32).toFixed(1)) + "Â°F";
}

function getFormatedTemperatureNoUnit(t,u){
     
  if (u == 0 ) return parseFloat(parseFloat(t).toFixed(1));
  else return parseFloat(parseFloat(t*1.8+32).toFixed(1));
}

function readableSize(a, b, c, d, e) {
    return (b = Math, c = b.log, d = 1000, e = c(a) / c(d) | 0, a / b.pow(d, e)).toFixed(0) + '' + (e ? 'kMGTPEZY' [--e] + 'B' : 'B')
}

function cursorLoading(){
  document.body.style.cursor = 'progress';
  document.getElementById("lista").innerHTML = "<div class='col-12 mt-5' style='width:100%!important;text-align:center;color:#cccccc;'>loading ...</div>";
}

function cursorDone(){
  document.body.style.cursor = 'default';
}      

   
</script>
       <script src="main.js?v=14"></script><script>loadDevicesName();loadDevices();</script>
    </html>
  